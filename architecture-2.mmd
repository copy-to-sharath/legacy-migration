---
config:
  layout: elk
  look: neo
  theme: neo
---
flowchart TB
  subgraph L1[Developer - VS Code]
    direction TB
    A1[User request in VS Code]
    A2[Select Agent - Generator]
    A3[Review output and Judge report]
    A4[Human approval gate]
  end

  subgraph L2[Agent Runtime - Copilot Chat]
    direction TB
    B1[Generator agent]
    B2[Judge agent]
    B3[Generator report]
  end

  subgraph L3[MCP Client and Config]
    direction TB
    C1["VS Code MCP config<br/>.vscode/mcp.json"]
    C2["Copilot MCP config<br/>workspace/deliverables/generated/copilot-mcp.json"]
    C3[MCP client]
  end

  subgraph L4[MCP Server - graph-vector-mcp]
    direction TB
    D1[initialize, tools/list, prompts/list]
    D4[prompts/get]
    D2[tools/call - neo4j_query]
    D3[tools/call - qdrant_search and qdrant_scroll]
  end

  subgraph L5[Data Stores]
    direction TB
    E1[Neo4j - graph]
    E2[Qdrant - vector]
    E3[Parquet and Roslyn index]
  end
  A1 -->|1| A2 -->|2| B1
  B1 -->|3| C3
  C1 -->|4| C3
  C2 -->|5| C3
  C3 -->|6| D1 -->|7| D4 -->|8| B1
  B1 -->|9| D2 -->|10| E1
  B1 -->|11| D3 -->|12| E2
  E3 -.->|13| D2
  E3 -.->|14| D3
  subgraph L6[Deliverables - step by step]
    direction TB
    M1["1. API Mapping Generator<br/>Agent-Map-Gen-5"]
    M2["API Mapping Judge<br/>Agent-Map-Judge-5"]
    M4["2. BRD Generator<br/>Agent-BRD-Gen-2"]
    M5["BRD Judge<br/>Agent-BRD-Judge-2"]
    M7["3. Gherkin Generator<br/>Agent-Gherkin-Gen-3"]
    M8["Gherkin Judge<br/>Agent-Gherkin-Judge-3"]
    M10["4. Tests Generator<br/>Agent-Test-Gen-7"]
    M11["Tests Judge<br/>Agent-Test-Judge-7"]
    M13["5. Code Generator<br/>Agent-Code-Gen-6"]
    M14["Code Judge<br/>Agent-Code-Judge-6"]

    M1 -->|15| M2 -->|16| A3 -->|17| A4 -->|18| M4
    M4 -->|19| M5 -->|20| A3 -->|21| A4 -->|22| M7
    M7 -->|23| M8 -->|24| A3 -->|25| A4 -->|26| M10
    M10 -->|27| M11 -->|28| A3 -->|29| A4 -->|30| M13
    M13 -->|31| M14 -->|32| A3 -->|33| A4
  end
  B1 -->|34| M1
  M2 -->|35| B2
  M5 -->|36| B2
  M8 -->|37| B2
  M11 -->|38| B2
  M14 -->|39| B2
  B2 -->|40| B3